<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Trombinoscope - @noelno</title>

<link rel="stylesheet" type="text/css" href="normalize.css" />
<link rel="stylesheet" type="text/css" href="style.css" />
<script src="../js/jquery.min.js" ></script>
<script src="../js/d3.v3.min.js" ></script>
<script>
        /* Variables globale utilisée pour garder en mémoire les données du formulaire sous forme de tableau 
           hors de la fonction qui traite le flux csv, et donc à portée de la fonction voirData();
           Une ligne = un étudiant = une case du tableau. 
           Ex : le premier étudiant de la liste est accessible en dataEtudiants[0] */
	var dataEtudiants;
        var cReseau = ['mail','login Github','login Diigo','page linkedIn','compte viadéo'];
        var cLang = ['Javascript','CSS','HTML','PHP','SVG','OWL','JAVA','XML','SCALA','.NET','JSON','Objective-C','Android','page linkedIn','login twitter','compte viadéo','Action script','JQuery','Cordova','Bootstrap','D3','SQL','SASS','COMPASS','Symphony','Zend','AJAX'];
        var cCMS = ['Drupal','Wordpress','Joomla','Prestashop','Magento','SPIP','COMPASS'];
        var cGraph = ['Photoshop','GIMP','IN Design','Illustrator','Inkscape','Paint','3DS MAX','Blender','Maya','After Effect','Final Cut Pro','Première','Cinéma 4D','Flash','Bridge','.NET','JSON','Objective-C','Android','Action script','JQuery','Cordova','Bootstrap','D3','SQL'];               
        var niveau = {'nul':10,'moins nul':30, 'bon':50,'trop bon':75,'expert':100};
        
        /**
         * jQuery. Les instructions qui suivent s'exécutent après le chargement du DOM. (les balises, pas les fichiers source).
         * Cette fonction reçoit en paramètre une autre fonction qu'elle exécute immédiatement.
         * @returns {undefined}
         */
	$(document).ready(  
		function() //Fonction anonyme. Pas besoin de nom car elle est exécutée immédiatement et une seule fois.
		{
                        /* Récupère les données de tous les étudiants dans un objet data */
                        d3.csv("../php/lecteurFlux.php?url=cdnl1516data", function(data) {
                                dataEtudiants = data;                  
                                /**
                                * jQuery. Requête HTTP au serveur hébergeant le fichier xml de notre répertoire Picasa.
                                * Tente de récupérer les données du fichier xml dans un objet xml puis crée les éléments 
                                * de la page en cas de succès.
                                */
                                $.ajax( 
                                {
                                       type: "GET",
                                       url: "../php/lecteurFlux.php?url=cdnl1516photo",
                                       dataType: "xml",
                                       success: function(xml) 
                                       {
                                               var numPhoto = 0; //initialisation d'un compteur qui permettra de numéroter les photos du répertoire Picasa dans l'ordre

                                               /**
                                                * jQuery. Pour chaque balise <enclosure> trouvée dans le DOM du fichier xml le code suivant sera exécuté
                                                */
                                               $(xml).find('enclosure').each(
                                                       /**
                                                        * Crée dans la <div id="DIV_Xml"> une nouvelle <div> pour chaque étudiant, 
                                                        * avec le numéro d'ordre d'appartition de la photo dans l'album,
                                                        * concaténé avec "carte_" pour distinguer chaque div l'une de l'autre. 
                                                        * Chaque <div> a pour enfant une <img> qui appelle au clic une fonction voirData().
                                                        * Cette fonction reçoit en paramètre l'url de la photo en cours d'itération.
                                                        * La boucle s'arrête donc quand la dernière photo du répertoire a été affichée.
                                                        * @returns {undefined}
                                                        */
                                                       function()
                                                       {
                                                               /* this.attributes[1].nodeValue correspond à la valeur du deuxième attribut
                                                                * de la balise sur laquelle on itère (ici <enclosure> pour rappel). Soit
                                                                * la valeur de l'attribut url, qui dans le fichier xml du répertoire Picasa 
                                                                * correspond à l'url de la photo.
                                                                * C'est justement parce que c'est la balise <enclosure> qui porte l'url de
                                                                * la photo que l'on itère sur cette balise et pas une autre.
                                                                */
                                                               $('<li class="carte_id" id="etudiant_' + numPhoto + '"></li>').html('<img src="' + this.attributes[1].nodeValue + '" /><div id="nomprenom_' + numPhoto +'" class="nomprenom">'+ voirData(numPhoto) +'</div>').appendTo('#Div_XML');
                                                               numPhoto++;
                                                       });
                                        }
                                });
                        });		   		   
		}
        );
	
        /**
         * Recherche dans le csv les données qui correspondent au numéro de photo transmis en paramètre. 
         * @param {Nombre Entier} noPhoto : identifiant de la photo 
         * @returns {Void}
         */
	function voirData(numPhoto){
		/**
                 * Pour chaque élément / étudiant du tableau, comparer le numéro de photo envoyé en paramètre
                 * et la valeur du champ "idPhoto" qui est le numéro de photo de l'étudiant.
                 * Si le numéro de photo correspond à celui d'un étudiant, une nouvelle <div> contenant 
                 * les informations de l'étudiant est créee.
                 * Toutes les données du CSV sont rapatriées en chaîne de caractère. 
                 * 
                 * Note : une chaine de caractère vide ("") vaut 0, donc sans la condition 
                 * etudiantCourant.idPhoto != "", les étudiants sans photo (donc avec une case vide "")
                 * se verraient tous affecter la première photo de l'album...
                 * On aurait aussi pu éviter le problème en initialisant le compteur idPhoto à 1, mais
                 * il faudrait mettre à jour le csv pour ajouter +1 au champ idPhoto.
                 */
                var dataHTML = "";
		dataEtudiants.forEach(function(etudiantCourant){
			if(etudiantCourant['idPhoto'] == numPhoto && etudiantCourant.idPhoto != ""){
                                //vérifier pour chaque champ s'il n'est pas égal à ""
                                //des boutons plutôt que de l'affichage des comptes rs
                                //var identite = "<h1>"+etudiantCourant['Prénom']+" "+etudiantCourant['Nom']+"</h1>";
                                //var reseaux = "<ul class='donnees_de_base'><li>" + etudiantCourant['mail'] + "</li><li>Compte Github : @" + etudiantCourant['login Github']+"</li><li>Compte Diigo : " + etudiantCourant['login Diigo']+"</li><li>LinkedIn : " + etudiantCourant['page linkedIn']+"</li><li>Twitter : @" + etudiantCourant['login twitter']+"</li><li>Viadeo : " + etudiantCourant['compte viadéo']+"</li></ul>";
                                dataHTML = "<h1>"+etudiantCourant['Prénom']+" "+etudiantCourant['Nom']+"</h1>";	
			}
		});
		return dataHTML;
      	}
</script>
</head>
<body>         
                <nav id="menu">
                        <!-- <img src="logo.gif" /> -->
                        <h1 id="titre">Trombinoscope</h1>
                        <p id="presentation">Lorem ipsum</p>
                        <p id="copyright">Copyright etc... - @noelno</p>
                </nav>
            
                <article id="content">
                        <ul id="Div_XML"></ul>
                </article>
</body>
</html>